<%unless @user.new_record?%>
  <%= content_tag :p, t('.instructions') %>
  <p><strong><%= t('.name') %></strong></p>
  <hr/>
<%end%>

<% errors = @user.errors[:login_id] %>
<% validation_class = errors.empty? ? {} : 'error' %>
<div class="control-group <%= validation_class %>">
  <%= f.label :login_id, class: 'control-label required' %>
  <div class="controls">
    <%= f.text_field :login_id, readonly: !@user.new_record?, :class => "required", 'aria-required' => 'true' %>
    <span class="help-inline">
      <%#= errors.join (', ') %>
    </span>
  </div>
</div>

<% errors = @user.errors[:first_name] %>
<% validation_class = errors.empty? ? {} : 'error' %>
<div class="control-group <%= validation_class %>">
  <%= f.label :first_name, :class => 'control-label required' %>
  <div class="controls">
    <%= f.text_field :first_name, :class => "required", 'aria-required' => 'true' %>
    <span class="help-inline">
      <%#= errors.join (', ') %>
    </span>
  </div>
</div>

<% errors = @user.errors[:last_name] %>
<% validation_class = errors.empty? ? {} : 'error' %>
<div class="control-group <%= validation_class %>">
  <%= f.label :last_name, :class => 'control-label required' %>
  <div class="controls">
    <%= f.text_field :last_name, :class => "required", 'aria-required' => 'true' %>
      <span class="help-inline">
        <%#=errors.join (', ')%>
    </span>
  </div>
</div>


<% if @user.new_record? %>
  <% @required = 'required' %>
<% else %>
  <% @required = '' %>
<%end%>

<% if session[:login_method] != 'shibboleth' %>

  <% errors = @user.errors[:password] %>
  <% validation_class = errors.empty? ? {} : 'error' %>
  <div class="control-group <%= validation_class %>">
    <%= f.label :password, password_label(@user), :class => 'control-label '+@required %>
    <div class="controls">
      <%= f.password_field :password, :class => '' +@required %>

      <%= content_tag :span, '', title: t('.password_tooltip'),
                      data: {placement: 'right'}, class: 'icon questionmark tip' %>
        <span class="help-inline">
          <%#=errors.join (', ')%>
      </span>
    </div>
  </div>

  <% errors = @user.errors[:password_confirmation] %>
  <% validation_class = errors.empty? ? {} : 'error' %>
  <div class="control-group  <%= validation_class %>">
    <%= f.label :password_confirmation, :class => 'control-label '+@required %>
    <div class="controls">
      <%= f.password_field :password_confirmation, :class => "" +@required %>
        <span class="help-inline">
          <%#=errors.join (', ')%>
      </span>
    </div>
  </div>

<%end%>

<%unless @user.new_record?%>
  <p><strong><%= t('.contact_info') %></strong></p>
  <hr/>
<%end%>

<% errors = @user.errors[:email] %>
<% validation_class = errors.empty? ? {} : 'error' %>
<div class="control-group <%= validation_class%>">
  <%= f.label :email, :class => 'control-label required' %>
  <div class="controls">
    <%= f.text_field :email, readonly: !@email_editable, :class => '', 'aria-required' => 'true' %>
      <span class="help-inline">
        <%#=errors.join (', ')%>
      </span>
  </div>
</div>

<% errors = @user.errors[:institution_id] %>
<% validation_class = errors.empty? ? {} : 'error' %>
<div class="control-group  <%= validation_class %>">
  <%= f.label :institution_id, :class => 'control-label' %>
  <div class="controls">
    <% # filter institution list in my profile page only %>
    <% if @user.new_record? %>
      <%= f.select( :institution_id,
          @institution_list,
          {prompt: t('.select_institution_new')},
          :class => "input-xxlarge") %>
    <% else %>
      <%= f.select( :institution_id,
        @institution_list,
        {prompt: t('.select_institution')},
        :class => "input-xxlarge")%>
    <% end %>

    <span class="help-in-line">
      <%#=errors.join (', ')%>
    </span>
  </div>
</div>

<% unless @user.new_record? %>
  <%if @user.role_names.any?%>
    <p><strong><%= t('.dmp_options') %></strong></p>
	   <hr/>
    <div class="control-group">
      <%= content_tag :p, t('.roles'), class: 'control-label' %>
      <div class="controls">
        <p><%= t(@user.role_names, scope: 'enum.role.name').join(' | ') %>
          <%= content_tag :span, '', title: t('.roles_tooltip'),
                          data: {placement: 'right', html: 'true'},
                          class: 'icon questionmark tip' %>
        </p>
      </div>
    </div>
  <%end%>
<% end %>

<% unless @user.new_record? %>
    <p><strong><%= t('.orcid') %></strong></p>
    <hr/>

    <% if @user.orcid_id.nil? || @user.orcid_id.blank? %>
      <div class="control-group" style="position: relative">
        <%= content_tag :span, '', title: t('.orcid_tooltip'),
                        data: {placement: 'right'},
                        class: 'icon questionmark tip',
                        style: 'position: absolute; top: 7px; left: 142px' %>
        <%= f.label :orcid_id, class: 'control-label' %>
        <a href="http://orcid.org/">
          <%= image_tag 'orcid_id.gif', alt: t('.orcid_logo_alt'), style: 'position: absolute; top: 11px; left: 230px' %>
        </a>
        <%= f.text_field :orcid_id, class: 'orcid_widget', placeholder: 'xxxx-xxxx-xxxx-xxxx' %>
        <%= javascript_include_tag("orcid_widget.js") %>
        <%= content_tag :span, '', title: t('.orcid_lookup_tooltip'),
                        data: {placement: 'right'},
                        class: 'icon questionmark tip',
                        class: 'position: absolute; top: 12px; left: 780px' %>
      </div>

    <% else %>

      <% @sub_orcid_id = @user.orcid_id.gsub("http://", "")%>
      <div class="control-group">
        <%= f.label :orcid_id, class: 'control-label' %>
        <div class="controls everythingOnOneLine">
          <a href="http://orcid.org/">
            <%= image_tag 'orcid_id.gif', alt: t('.orcid_logo_alt') %>
          </a>
          <p><%= link_to @sub_orcid_id, @user.orcid_id %></p>
          &nbsp;&nbsp;&nbsp;
          <p><%= link_to t('.edit_orcid_link'), '#', id: 'change_orcid' %></p>
          &nbsp;&nbsp;&nbsp;
          <p><%= link_to t('.delete_orcid_link'), remove_orcid_path(user_id: @user), id: 'remove_orcid' %></p>
        </div>
      </div>

      <div class="control-group" id="orcid_input_box">
        <%= f.label :orcid_id, class: 'control-label' %>
        <%= f.text_field :orcid_id, class: 'orcid_widget', placeholder: 'xxxx-xxxx-xxxx-xxxx' %>
        <%= javascript_include_tag("orcid_widget.js") %>
      </div>

    <% end %>
<% end %>


<% unless @user.new_record? %>
  <p><strong><%= t('.api_token') %></strong></p>
  <hr/>
  <div class="control-group">
    <%= f.label :auth_token, class: 'control-label' %>
    <div class="controls everythingOnOneLine">
      <div id="token_partial">
        <%= render partial: 'token'%>
      </div>
    </div>
  </div>
<% end %>

























